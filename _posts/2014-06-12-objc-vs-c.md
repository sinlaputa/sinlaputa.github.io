---
layout: post
title: "Objective-C与C语言的差异"
description: "整理Objc与C语言之间的差异，以便理解与记忆"
tags: [objc, c]
modified: 2014-06-15
image:
  feature: abstract-1.jpg
##comments: true
##share: true
---

眼看着Swift要取代Objc，此时整理一下Objc与C之间的差异正好。Objective-C诞生于80年代，以SmallTalk-80为基础在C上加了一层，
以支持对象的创建和操作。Apple与Objc的渊源自1988年NeXT公司获取Objc语言的授权开始，NeXT公司发展了Objc的语言库和开发环境即NEXTSTEP。
1996年Apple收购NeXT公司，NEXTSTEP/OPENSTEP环境在之后作为OS X的基础被Apple称为Cocoa。

## 类、对象、方法
整体来说，Objc的对象系统更类似于Java而非C++。Objc采用单继承结构，大部分的对象都继承于根父类NSObject，
通过类似于Java中接口的“协议”来扩展类定义，也可以通过“分类”来扩展（关于协议和分类详见下）。

Objc中类的定义包括显示分离的接口定义和实现两部分，一般来说分别放在.h和.m文件中。
接口定义@interface和@end之间，一般定义对外的公开信息，包括类方法、实例方法、属性等，其中属性是对类成员变量的一种友好封装，
属性鼓励对成员变量进行封装，可自动合成存取器（即get，set操作），可对多线程访问，引用类型和深浅拷贝进行配置。
实现部分定义在@implementation和@end之间，主要描述成员数据、合成属性存取器以及实现接口中声明的方法。

Objc中类有类方法和实例方法，分别在函数声明定义时用+和-来标识；有实例变量，但是没有类变量，
可使用全局变量或者预编译指令来实现替代效果。
比较独特的一点是，当函数的参数数量大于1，从第2个参数起需要指定名称，类似于关键字参数，
不过调用时需要严格按声明和实现时的顺序指定。

需要指出的是，Objc并非像Java一样原生支持垃圾回收，不过在Xcode4.2之后可以开启ARC（Automatic Reference Counting）来自动释放内存，
若没特殊原因，也推荐使用ARC。

## 多态、动态类型、动态绑定
Objc扩展C本身是静态类型的，通过引入id变量，可以使用id变量引用任何对象变量，又有了动态类型的特点。
静态类型的特点是可在编译期检查类型的一致，更早的暴露潜在的错误，也方便编译期做优化提升执行效率，
当然代码整体的可读性要更强。
动态类型的特点是灵活，id变量有些通用指针的意味，可以免去纯静态类型中复杂的转换过程。

整体的Objc类是使用结构来实现的，实例变量存储在结构中，继承的实例变量加上添加的变量就组成了新的结构。
子类会继承父类的isa保护成员用以确定对象的类，供运行时系统使用。
对象变量其实是指向结构的指针，而id类型是通用指针类型，类似于C中的void *指针。

## 继承、分类、协议
对于支持对象的语言来说，比较常见的扩展类定义的方法有继承和接口，在Objc中用协议来实现类似接口的功能。
协议其实是一个方法列表，可用关键字@optional来指定某些方法是可选实现的。
类对象可以遵守多个协议，若一个类遵守某个协议，意味着其子类也遵守此协议。
系统可使用运行时类型信息判断对象是够遵守某个协议，以支持灵活的操作，如实现代理模式。

分类是一种非常见的扩展类的方法，主要是用来增强原有的类定义。不像协议，这种增强可能不是能抽象出作为共性的，
而只是添加一个初始化函数入口而已。扩展类定义也可以添加变量，而并非只有方法，与定义类的灵活度相同。
一个类可以拥有多个分类，使用分类添加新方法来扩展类不仅会影响这个类，同时也会影响它的所有子类。

## 作用域与命名空间
Objc继承了C中变量的作用域规则，局部变量，全局变量，局部静态变量，全局静态变量等的规则与C相同。
虽然支持对象，但并没有命名空间划分的概念，其名称空间为所有的程序代码与所有的库、框架和插件共享的，
究其原因是由于对象底层是用结构实现的，并没有在C的基础上做太多的改动，
因而在自定义类、扩展原有类时必须小心命名冲突。

为支持类的信息隐藏和封装特性，Objc对类中的实例变量添加了可见性指令。

* @protected指令后的实例变量可被该类及其子类定义的方法直接访问，是接口部分定义的实例变量的默认作用域
* @private指令后面的被该类的方法直接访问，不能被子类中定义的方法访问，是实现部分定义的实例变量的默认作用域
* @public指令可被所有类或模块中定义的方法直接访问
* @package指令涉及到runtime system，简单来说其可见性介于@private和@protected之间

## 基础类型、分支循环结构、块
Objc除定义了一些便利用的宏之外，并没有在C语言上添加额外的基础类型，
分支循环结构也没有做扩展。

为了实现类似闭包的功能，Objc中引入了块，块并非是标准ANSI C所定义的部分。
块使用结构来实现，而看起来更像是函数，块可以有参数和返回值。
与函数不同的是，块定义可以在函数或者方法的内部，并能够访问在函数或者方法返回内块之外的任何变量，甚至可以通过特殊指令对其修改。
块也可以定义在函数之外，全局的或者局部的，可以赋值给变量，之后可以像使用函数指针一样使用此变量。
块的引入变相突破了C语言中函数不能嵌套的语法限制，增强了语言的表达力和灵活性。

## 程序库
相对于C语言的标准库，Objc提供的语言库要丰富得多，特别是使用Apple提供的编程环境。
在Mac OS X系统中，术语Cocoa总的来说指的是Foundation框架、Application Kit框架和Core Data框架。
框架是指由许多类、方法、函数和文档按照一定的逻辑组织起来的集合，一般来说，不同框架针对不同的问题。
例如Foundation框架为所有的程序开发奠定基础，其提供了数字和字符串等基本对象，数组、字典和集合等一些对象集合，
并提供处理日期和时间，自动化内存管理、处理基础文件系统，处理几何数据结构等功能。

Apple的编程环境提供了上百个框架可供使用，并提供了详尽的文档和示例供参考。
因而对于新接触Mac OS或者iOS开发的开发者，首先该大体熟悉这些框架，
至少知道用什么该去哪儿找，而非遇到困难求助搜索引擎或者自己拍脑袋想方案事倍功半。

